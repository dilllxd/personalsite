<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Last.fm Failover Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .config { background: #f5f5f5; padding: 15px; border-radius: 5px; margin: 20px 0; }
        .result { background: #e8f5e8; padding: 15px; border-radius: 5px; margin: 20px 0; }
        .error { background: #ffe8e8; padding: 15px; border-radius: 5px; margin: 20px 0; }
        button { padding: 10px 20px; font-size: 16px; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>Last.fm Failover Test</h1>

    <div class="config">
        <h3>Configuration</h3>
        <p>To test, enter your Last.fm credentials:</p>
        <input type="text" id="apiKey" placeholder="Last.fm API Key" style="width: 300px; margin: 5px;">
        <br>
        <input type="text" id="username" placeholder="Last.fm Username" style="width: 300px; margin: 5px;">
        <br>
        <button onclick="testLastFm()">Test Last.fm Connection</button>
    </div>

    <div id="result"></div>

    <script src="static/js/lastfm-service.js"></script>
    <script>
        async function testLastFm() {
            const apiKey = document.getElementById('apiKey').value;
            const username = document.getElementById('username').value;
            const resultDiv = document.getElementById('result');

            if (!apiKey || !username) {
                resultDiv.innerHTML = '<div class="error"><h3>Error</h3><p>Please enter both API key and username</p></div>';
                return;
            }

            try {
                resultDiv.innerHTML = '<div class="result"><h3>Testing...</h3><p>Connecting to Last.fm API...</p></div>';

                const service = new LastFmService(apiKey, username);
                const data = await service.getRecentTracks();

                if (data && data.music) {
                    resultDiv.innerHTML = `
                        <div class="result">
                            <h3>✅ Success!</h3>
                            <p><strong>Track:</strong> ${data.music.title}</p>
                            <p><strong>Artist:</strong> ${data.music.artist}</p>
                            <p><strong>Album:</strong> ${data.music.album || 'Unknown'}</p>
                            <p><strong>Status:</strong> ${data.music.status}</p>
                            <p><strong>Art URL:</strong> ${data.music.artUrl || 'None'}</p>
                            <h4>Raw Response:</h4>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = '<div class="error"><h3>Error</h3><p>No recent tracks found or invalid response</p></div>';
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        <h3>❌ Error</h3>
                        <p><strong>Message:</strong> ${error.message}</p>
                        <p><strong>Check:</strong></p>
                        <ul>
                            <li>API key is correct</li>
                            <li>Username is correct (case-sensitive)</li>
                            <li>Profile is public</li>
                            <li>You have recent scrobbles</li>
                        </ul>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>